import streamlit as st
import pandas as pd
import re
from datetime import datetime
from docx import Document
from docx.shared import Inches, Pt, RGBColor
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.enum.section import WD_SECTION_START
from docx.oxml.ns import qn
from docx.oxml import OxmlElement
import io

@st.cache_data
def load_ins_database():
    return pd.read_csv("ins_database.csv", encoding="utf-8-sig")

@st.cache_data
def load_warnings_database():
    return pd.read_csv("warnings_database.csv", encoding="utf-8-sig")

# Define standard colors
COLOR_SUCCESS = RGBColor.from_string("006400")  # Dark Green
COLOR_FAILURE = RGBColor.from_string("8B0000")  # Dark Red
COLOR_WARNING = RGBColor.from_string("FF8C00")  # Dark Orange
COLOR_BLACK = RGBColor.from_string("000000")

TARGET_FONT_NAME = 'TH Sarabun New'
TARGET_FONT_SIZE = Pt(14)

# Helper function to add a styled heading with numbering
def add_styled_heading(document, text, level=1, numbered=True, section_number=""):
    prefix = f"{section_number} " if numbered and section_number else ""
    heading = document.add_heading(f"{prefix}{text}", level=level)
    for run in heading.runs:
        run.font.bold = True 
    heading.paragraph_format.space_after = Pt(6)
    return heading

# Helper function to add a paragraph with specific styling
def add_styled_paragraph(document, text, bold=False, italic=False, color=COLOR_BLACK, alignment=WD_ALIGN_PARAGRAPH.LEFT):
    p = document.add_paragraph()
    run = p.add_run(text)
    run.bold = bold
    run.italic = italic
    if color:
        run.font.color.rgb = color
    p.alignment = alignment
    p.paragraph_format.space_after = Pt(4)
    return p

def add_page_numbers(document):
    for section in document.sections:
        footer = section.footer
        p = footer.paragraphs[0] if footer.paragraphs else footer.add_paragraph()
        p.alignment = WD_ALIGN_PARAGRAPH.CENTER
        fldChar1 = OxmlElement('w:fldChar')
        fldChar1.set(qn('w:fldCharType'), 'begin')
        instrText = OxmlElement('w:instrText')
        instrText.set(qn('xml:space'), 'preserve')
        instrText.text = "PAGE"
        fldChar2 = OxmlElement('w:fldChar')
        fldChar2.set(qn('w:fldCharType'), 'end')
        run = p.add_run()
        run.element.append(fldChar1)
        run.element.append(instrText)
        run.element.append(fldChar2)

def generate_label_word_report(report_data):
    """‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£"""
    document = Document()
    
    # Set default font for the document
    style = document.styles['Normal']
    font = style.font
    font.name = TARGET_FONT_NAME
    font.size = TARGET_FONT_SIZE
    style.paragraph_format.space_after = Pt(4)

    # Main Title
    title_p = document.add_paragraph()
    title_run = title_p.add_run("‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    title_run.font.bold = True 
    title_p.alignment = WD_ALIGN_PARAGRAPH.CENTER
    title_p.paragraph_format.space_after = Pt(12)

    # Add disclaimer box
    disclaimer_p = document.add_paragraph()
    disclaimer_p.alignment = WD_ALIGN_PARAGRAPH.CENTER
    disclaimer_run = disclaimer_p.add_run("‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô \n‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ \n‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î")
    disclaimer_run.font.bold = True
    disclaimer_run.font.color.rgb = COLOR_WARNING
    disclaimer_p.paragraph_format.space_after = Pt(18)

    # 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    add_styled_heading(document, "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", level=2, section_number="1.")
    
    add_styled_paragraph(document, f"‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {report_data.get('food_name', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
    add_styled_paragraph(document, f"‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {report_data.get('food_type', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
    add_styled_paragraph(document, f"‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {report_data.get('food_consistency', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
    add_styled_paragraph(document, f"‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {report_data.get('food_registration_number', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
    add_styled_paragraph(document, f"‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤: {report_data.get('shelf_life_option', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
    
    if report_data.get('manufacturer_name'):
        add_styled_paragraph(document, f"‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï: {report_data.get('manufacturer_name')}")
    if report_data.get('manufacturer_address'):
        add_styled_paragraph(document, f"‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï: {report_data.get('manufacturer_address')}")
    
    document.add_paragraph()

    # 2. ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    add_styled_heading(document, "‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£", level=2, section_number="2.")
    
    # ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å
    if report_data.get('main_ingredients'):
        add_styled_paragraph(document, "‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å:", bold=True)
        for i, ingredient in enumerate(report_data.get('main_ingredients', []), 1):
            add_styled_paragraph(document, f"{i}. {ingredient}")
    
    # ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å
    if report_data.get('ingredient_warnings'):
        add_styled_paragraph(document, "‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å:", bold=True)
        for warning in report_data.get('ingredient_warnings', []):
            add_styled_paragraph(document, f"‚ö†Ô∏è {warning}", color=COLOR_WARNING)
    
    # ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    if report_data.get('ins_results'):
        add_styled_paragraph(document, "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (INS):", bold=True)
        for ins_result in report_data.get('ins_results', []):
            if ins_result.get('has_special_label'):
                add_styled_paragraph(document, f"‚ö†Ô∏è {ins_result.get('message')}", color=COLOR_WARNING)
            else:
                add_styled_paragraph(document, f"‚úÖ {ins_result.get('message')}", color=COLOR_SUCCESS)
    
    document.add_paragraph()

    # 3. ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ
    add_styled_heading(document, "‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ", level=2, section_number="3.")
    
    if report_data.get('has_allergen'):
        allergen_groups = report_data.get('allergen_groups', [])
        if allergen_groups:
            allergen_text = ", ".join(allergen_groups)
            add_styled_paragraph(document, f"‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ: {allergen_text}", color=COLOR_WARNING)
        else:
            add_styled_paragraph(document, "‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏•‡∏∏‡πà‡∏°", color=COLOR_WARNING)
    else:
        add_styled_paragraph(document, "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ", color=COLOR_SUCCESS)
    
    document.add_paragraph()

    # 4. ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£
    add_styled_heading(document, "‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", level=2, section_number="4.")
    
    if report_data.get('has_nutrition_claim'):
        add_styled_paragraph(document, "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", color=COLOR_WARNING)
        add_styled_paragraph(document, "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏â‡∏•‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢")
    else:
        add_styled_paragraph(document, "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", color=COLOR_SUCCESS)
    
    document.add_paragraph()

    # 5. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å
    add_styled_heading(document, "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å", level=2, section_number="5.")
    
    required_labels = report_data.get('required_labels', [])
    if required_labels:
        for i, label in enumerate(required_labels, 1):
            add_styled_paragraph(document, f"{i}. {label}")
    else:
        add_styled_paragraph(document, "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å", italic=True)
    
    document.add_paragraph()

    # 6. ‡∏™‡∏£‡∏∏‡∏õ
    add_styled_heading(document, "‡∏™‡∏£‡∏∏‡∏õ", level=2, section_number="6.")
    add_styled_paragraph(document, f"‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {len(required_labels)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", color=COLOR_SUCCESS)
    add_styled_paragraph(document, f"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}")

    add_page_numbers(document)

    # Global Font Override
    for paragraph in document.paragraphs:
        for run in paragraph.runs:
            run.font.name = TARGET_FONT_NAME
            run.font.size = TARGET_FONT_SIZE
    
    for table in document.tables:
        for row in table.rows:
            for cell in row.cells:
                for paragraph in cell.paragraphs:
                    for run in paragraph.runs:
                        run.font.name = TARGET_FONT_NAME
                        run.font.size = TARGET_FONT_SIZE

    file_stream = io.BytesIO()
    document.save(file_stream)
    file_stream.seek(0)
    return file_stream

def normalize_ins(s):
    return re.sub(r"\s+", "", str(s)).lower()

def show():
    st.title("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    st.markdown("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    # Initialize session state for dynamic fields
    if "main_ingredient_count" not in st.session_state:
        st.session_state.main_ingredient_count = 5
    
    if "ins_count" not in st.session_state:
        st.session_state.ins_count = 3
    
    # Function to add more fields
    def add_main_ingredient():
        st.session_state.main_ingredient_count += 1
    
    def add_ins():
        st.session_state.ins_count += 1

    # 1. ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("1. ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô)")
    food_name = st.text_input("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£", placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÇ‡∏Æ‡∏•‡∏ß‡∏µ‡∏ó")
    
    # 2. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ä‡∏ô‡∏¥‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("2. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ä‡∏ô‡∏¥‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    food_type = st.selectbox(
        "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
        [
            "‡∏≠‡∏∑‡πà‡∏ô‡πÜ",
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á‡∏ó‡∏≠‡∏î‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏Å‡∏£‡∏µ‡∏¢‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ñ‡∏±‡πà‡∏ß‡∏•‡∏¥‡∏™‡∏á‡∏™‡πå‡∏≠‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™ ‡∏™‡∏≤‡∏´‡∏£‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏´‡∏°‡∏π‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö",
            "‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏£‡∏™‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï", 
            "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ç‡∏ô‡∏°‡∏≠‡∏ö ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡∏ô‡∏°‡∏Ç‡∏≤‡πÑ‡∏Å‡πà ‡πÄ‡∏ß‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏™‡∏≠‡∏î‡πÑ‡∏™‡πâ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ ‡πÄ‡∏Ñ‡πâ‡∏Å ‡∏Ç‡∏ô‡∏°‡πÑ‡∏´‡∏ß‡πâ‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏≠‡πÅ‡∏Ñ‡∏•‡∏£‡πå ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á‡∏ó‡πå ‡∏û‡∏≤‡∏¢‡πÑ‡∏™‡πâ‡∏ï‡πà‡∏≤‡∏á‡πÜ",
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏∂‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ",
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏∑‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏π‡πâ‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢",
            "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏¥‡∏ó",
            "‡∏ä‡∏≤‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏´‡∏•‡∏ß‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏´‡πâ‡∏á",
            "‡∏Å‡∏≤‡πÅ‡∏ü‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏´‡∏•‡∏ß‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏´‡πâ‡∏á",
            "‡∏ô‡∏°‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏ï‡πà‡∏á",
            "‡∏ô‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß",
            "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ç‡∏≠‡∏á‡∏ô‡∏°",
            "‡∏ô‡πâ‡∏≥‡∏ô‡∏°‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
            "‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ",
            "‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ",
            "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£"
        ]
    )
    
    if food_type != "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" and food_type != "‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ" and food_type != "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£":
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏â‡∏•‡∏≤‡∏Å GDA ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£")
    
    if food_type == "‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ":
        st.warning("‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á '‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏ß‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Ç‡∏ô‡∏≤‡∏î 5 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß")
    
    if food_type == "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£":
        st.warning("‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:")
        st.warning("‚Ä¢ '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1.5 ‡∏°‡∏°. ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
        st.warning("‚Ä¢ '‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        st.warning("‚Ä¢ '‡∏Ñ‡∏ß‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà ‡πÉ‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        st.warning("‚Ä¢ '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏ô‡∏≤‡∏ó‡∏∂‡∏ö ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    
    # 3. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("3. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    if food_type == "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£":
        consistency_options = ["‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß", "‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡πá‡∏á", "‡πÄ‡∏°‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•"]
    else:
        consistency_options = ["‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß", "‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡πá‡∏á"]
    
    food_consistency = st.radio(
        "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
        consistency_options
    )
    
    if food_consistency == "‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß":
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏•., ‡∏•‡∏¥‡∏ï‡∏£)")
    elif food_consistency == "‡πÄ‡∏°‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•":
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏°‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•‡πÉ‡∏ä‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡πá‡∏î, ‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•)")
    else:
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏±‡∏°, ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)")
    
    # 4. ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("4. ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    # Main ingredients section
    col1, col2 = st.columns([3, 1])
    with col1:
        st.markdown("**‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å**")
    with col2:
        st.button("+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å", on_click=add_main_ingredient, key="add_main")
    
    main_ingredients = []
    for i in range(st.session_state.main_ingredient_count):
        main_ing = st.text_input(f"‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å {i+1}", key=f"main_ing_{i}")
        if main_ing:
            main_ingredients.append(main_ing)
    
    st.write("")
    
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô
    caffeine_option = None
    container_type = None
    
    # ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏¥‡∏ó - ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    if food_type == "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏¥‡∏ó":
        st.markdown("**‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°**")
        
        caffeine_option = st.radio(
            "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô",
            ["‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô", "‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏£‡∏™‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", "‡∏ú‡∏™‡∏°‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô"],
            key="caffeine_option"
        )
        
        if caffeine_option == "‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏£‡∏™‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥":
            st.warning("‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏ß‡πà‡∏≤ '‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤")
        
        elif caffeine_option == "‡∏ú‡∏™‡∏°‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô":
            container_type = st.text_input("‡∏£‡∏∞‡∏ö‡∏∏‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏£‡∏à‡∏∏", placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á, ‡∏Ç‡∏ß‡∏î", key="container_type")
            if container_type:
                st.warning(f"‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ '‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πà‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 {container_type} ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏î‡∏∑‡πà‡∏° ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏∂‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏≤‡∏ß ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    
    # INS section
    col1, col2 = st.columns([3, 1])
    with col1:
        st.markdown("**‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£**")
    with col2:
        st.button("+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£", on_click=add_ins, key="add_ins")
    
    ins_list = []
    for i in range(st.session_state.ins_count):
        ins = st.text_input(f"‡πÄ‡∏•‡∏Ç INS {i+1}", key=f"ins_{i}")
        if ins:
            ins_list.append(ins)
    
    st.markdown(
        "üîó ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç INS ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå [‡∏Å‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏≠‡∏¢.)](https://alimentum.fda.moph.go.th/FDA_FOOD_MVC/Additive/Main)"
    )
    
    # 5. ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ
    st.subheader("5. ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ")
    has_allergen = st.checkbox("‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ")
    
    allergen_groups = []
    if has_allergen:
        allergen_options = [
            "‡∏ô‡∏°", "‡πÑ‡∏Ç‡πà", "‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", "‡∏ñ‡∏±‡πà‡∏ß‡∏•‡∏¥‡∏™‡∏á", "‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏Ç‡πá‡∏á", 
            "‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏≤‡∏•‡∏µ", "‡∏õ‡∏•‡∏≤", "‡∏Å‡∏∏‡πâ‡∏á/‡∏õ‡∏π/‡∏´‡∏≠‡∏¢", "‡∏á‡∏≤", "‡∏ã‡∏±‡∏•‡πÑ‡∏ü‡∏ï‡πå"
        ]
        allergen_groups = st.multiselect(
            "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ",
            allergen_options
        )
    
    # 6. ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£
    st.subheader("6. ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£")
    has_nutrition_claim = st.checkbox("‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£")
    
    if has_nutrition_claim:
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£' ‡πÅ‡∏•‡∏∞‡∏â‡∏•‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢")
    
    # 7. ‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("7. ‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    food_registration_number = st.text_input(
        "‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)", 
        placeholder="‡πÄ‡∏ä‡πà‡∏ô 12-1-12345-1-0001"
    )
    
    # 8. ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
    st.subheader("8. ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤")
    manufacturer_name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤")
    manufacturer_address = st.text_area("‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤")
    
    # 9. ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.subheader("9. ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    shelf_life_option = st.radio(
        "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤",
        ["‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô", "‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô"]
    )
    
    shelf_life_days = 90 if shelf_life_option == "‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô" else 365
    
    if shelf_life_option == "‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô":
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ")
    else:
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ")
    
    # 10. ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô
    st.subheader("10. ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô")
    has_desiccant = st.checkbox("‡∏°‡∏µ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô")
    
    if has_desiccant:
        st.warning("‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ '‡∏°‡∏µ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ‡πì ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß")
    
    # ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
    st.write("")
    st.write("")
    
    if st.button("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£", type="primary"):
        # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        generate_label_report(
            food_name, food_type, food_consistency, main_ingredients, ins_list,
            has_allergen, allergen_groups, has_nutrition_claim, 
            food_registration_number, manufacturer_name, manufacturer_address,
            shelf_life_option, has_desiccant, caffeine_option, container_type
        )

def generate_label_report(food_name, food_type, food_consistency, main_ingredients, ins_list,
                         has_allergen, allergen_groups, has_nutrition_claim,
                         food_registration_number, manufacturer_name, manufacturer_address,
                         shelf_life_option, has_desiccant, caffeine_option=None, container_type=None):
    """‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£"""
    
    st.markdown("---")
    st.markdown("## üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    st.markdown("### üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô")
    col1, col2 = st.columns(2)
    
    with col1:
        st.write(f"**‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£**: {food_name if food_name else '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'}")
        st.write(f"**‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£**: {food_type if food_type else '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'}")
        st.write(f"**‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£**: {food_consistency}")
    
    with col2:
        st.write(f"**‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£**: {food_registration_number if food_registration_number else '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'}")
        st.write(f"**‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤**: {shelf_life_option}")
    
    # ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.markdown("### üß™ ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    required_labels = []
    ins_results = []
    ingredient_warnings = []
    
    # ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å
    if main_ingredients:
        st.markdown("#### üìã ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å")
        ingredients_text = ", ".join(main_ingredients)
        st.write(f"**‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö**: {ingredients_text}")
        required_labels.append(f"‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö: {ingredients_text}")
        
        # ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å
        st.markdown("#### ‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å")
        warnings_db = load_warnings_database()
        
        for ing in main_ingredients:
            matched = warnings_db[warnings_db["keyword"].str.strip().str.lower() == ing.lower()]
            if not matched.empty:
                row = matched.iloc[0]
                warning_message = f"‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '{ing}': {row['warning']}"
                st.warning(f"‚ö†Ô∏è {warning_message}")
                required_labels.append(f"‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: {row['warning']}")
                ingredient_warnings.append(warning_message)
            else:
                st.success(f"‚úÖ '{ing}' ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞")
    
    # ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    if ins_list:
        st.markdown("#### üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (INS)")
        ins_db = load_ins_database()
        
        ins_db["normalized"] = ins_db["ins_number"].astype(str).apply(normalize_ins)
        
        for ins in ins_list:
            ins_norm = normalize_ins(ins)
            matched = ins_db[ins_db["normalized"] == ins_norm]
            if not matched.empty:
                row = matched.iloc[0]
                message = f"INS {row['ins_number']} ‡∏Ñ‡∏∑‡∏≠ {row['name_th']} ({row['function_group']}) | üìã ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏ß‡πà‡∏≤: {row['label_required_format']}"
                st.warning(f"‚ö†Ô∏è {message}")
                required_labels.append(f"‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {row['label_required_format']}")
                ins_results.append({
                    'has_special_label': True,
                    'message': message
                })
            else:
                message = f"'{ins}' ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á '‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (INS {ins},...)' ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"
                st.success(f"‚úÖ {message}")
                required_labels.append(f"‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (INS {ins})")
                ins_results.append({
                    'has_special_label': False,
                    'message': message
                })
    
    # ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ
    st.markdown("### üö® ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ")
    if has_allergen and allergen_groups:
        allergen_text = ", ".join(allergen_groups)
        st.warning(f"‚ö†Ô∏è **‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ**: {allergen_text}")
        required_labels.append(f"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ‡∏°‡∏µ{allergen_text}")
    else:
        st.success("‚úÖ **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ**")
    
    # ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£
    st.markdown("### üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£")
    if has_nutrition_claim:
        st.warning("‚ö†Ô∏è **‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£**")
        st.info("üìã **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏â‡∏•‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢")
        required_labels.append("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£")
        if food_type != "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" and food_type != "‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ" and food_type != "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£":
            required_labels.append("‡∏â‡∏•‡∏≤‡∏Å GDA")
    else:
        st.success("‚úÖ **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£**")
    
    # ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    st.markdown("### ‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£")
    
    # ‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ
    if food_type == "‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ":
        st.warning("‚ö†Ô∏è **‡∏ß‡∏∏‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á '‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏ß‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Ç‡∏ô‡∏≤‡∏î 5 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß")
        required_labels.append("‡πÅ‡∏™‡∏î‡∏á '‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏ß‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Ç‡∏ô‡∏≤‡∏î 5 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß")
    
    # ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    if food_type == "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£":
        st.warning("‚ö†Ô∏è **‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:")
        st.warning("‚Ä¢ '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1.5 ‡∏°‡∏°. ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°")
        st.warning("‚Ä¢ '‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        st.warning("‚Ä¢ '‡∏Ñ‡∏ß‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà ‡πÉ‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        st.warning("‚Ä¢ '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏ô‡∏≤‡∏ó‡∏∂‡∏ö ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°")
        required_labels.append("‡πÅ‡∏™‡∏î‡∏á '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1.5 ‡∏°‡∏°. ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
        required_labels.append("‡πÅ‡∏™‡∏î‡∏á '‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        required_labels.append("‡πÅ‡∏™‡∏î‡∏á '‡∏Ñ‡∏ß‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà ‡πÉ‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        required_labels.append("‡πÅ‡∏™‡∏î‡∏á '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏ô‡∏≤‡∏ó‡∏∂‡∏ö ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    
    # ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß ‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ç‡∏ô‡∏°‡∏≠‡∏ö
    if food_type in ["‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á‡∏ó‡∏≠‡∏î‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏Å‡∏£‡∏µ‡∏¢‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ñ‡∏±‡πà‡∏ß‡∏•‡∏¥‡∏™‡∏á‡∏™‡πå‡∏≠‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™ ‡∏™‡∏≤‡∏´‡∏£‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö ‡∏´‡∏°‡∏π‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏ö", 
                     "‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏£‡∏™‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï", 
                     "‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ç‡∏ô‡∏°‡∏≠‡∏ö ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏ö ‡∏Ç‡∏ô‡∏°‡∏Ç‡∏≤‡πÑ‡∏Å‡πà ‡πÄ‡∏ß‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏™‡∏≠‡∏î‡πÑ‡∏™‡πâ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ ‡πÄ‡∏Ñ‡πâ‡∏Å ‡∏Ç‡∏ô‡∏°‡πÑ‡∏´‡∏ß‡πâ‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏≠‡πÅ‡∏Ñ‡∏•‡∏£‡πå ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á‡∏ó‡πå ‡∏û‡∏≤‡∏¢‡πÑ‡∏™‡πâ‡∏ï‡πà‡∏≤‡∏á‡πÜ"]:
        st.warning("‚ö†Ô∏è **‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß/‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï/‡∏Ç‡∏ô‡∏°‡∏≠‡∏ö**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á '‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏ô‡∏≤‡∏ó‡∏∂‡∏ö ‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")
        required_labels.append("‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° '‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏ô‡∏≤‡∏ó‡∏∂‡∏ö ‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    
    # ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏¥‡∏ó - ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô
    if food_type == "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏¥‡∏ó":
        if caffeine_option == "‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏£‡∏™‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥":
            st.warning("‚ö†Ô∏è **‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô**: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô '‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£")
            required_labels.append("‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô '‡∏°‡∏µ‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤")
        elif caffeine_option == "‡∏ú‡∏™‡∏°‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô" and container_type:
            st.warning(f"‚ö†Ô∏è **‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏Å‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô**: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° '‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πà‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 {container_type} ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏î‡∏∑‡πà‡∏° ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô'")
            required_labels.append(f"‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° '‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πà‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 {container_type} ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏î‡∏∑‡πà‡∏° ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏∂‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏≤‡∏ß ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    
    # ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    ordered_labels = []
    
    # 1. ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    ordered_labels.append(f"‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£: {food_name if food_name else '[‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£]'}")
    
    # 2. ‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    ordered_labels.append("‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: https://food.fda.moph.go.th/media.php?id=629151820018753536&name=No-Color.png)")
    
    # 3. ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
    if main_ingredients:
        ingredients_text = ", ".join(main_ingredients)
        ordered_labels.append(f"‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö: {ingredients_text}")
    
    # 4. ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì
    if food_consistency == "‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß":
        ordered_labels.append("‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‚Ä¶.. ‡∏°‡∏•./‡∏•‡∏¥‡∏ï‡∏£")
    elif food_consistency == "‡πÄ‡∏°‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•":
        ordered_labels.append("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏ ‚Ä¶.. ‡πÄ‡∏°‡πá‡∏î/‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•")
    else:
        ordered_labels.append("‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‚Ä¶.. ‡∏Å‡∏£‡∏±‡∏°/‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°")
    
    # 5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ, ‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£, ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)
    for label in required_labels:
        if label not in ordered_labels:
            ordered_labels.append(label)
    
    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
    # ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
    if manufacturer_name:
        ordered_labels.append(f"‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï: {manufacturer_name}")
    if manufacturer_address:
        ordered_labels.append(f"‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á: {manufacturer_address}")
    
    # ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    if shelf_life_option == "‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 90 ‡∏ß‡∏±‡∏ô":
        ordered_labels.append("‡∏Ñ‡∏ß‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô (‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ)")
    else:
        ordered_labels.append("‡∏Ñ‡∏ß‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô (‡∏£‡∏∞‡∏ö‡∏∏ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ)")
    
    # ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô
    if has_desiccant:
        ordered_labels.append("‡∏£‡∏∞‡∏ö‡∏∏ '‡∏°‡∏µ‡∏ã‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πâ‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ‡πì ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£ ‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß")
    
    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
    for label in required_labels:
        if label not in ordered_labels:
            ordered_labels.append(label)
    
    # ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å
    st.markdown("### ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å")
    for i, label in enumerate(ordered_labels, 1):
        st.write(f"{i}. {label}")
    
    # ‡∏™‡∏£‡∏∏‡∏õ
    st.markdown("### üìä ‡∏™‡∏£‡∏∏‡∏õ")
    st.success(f"‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {len(ordered_labels)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word
    report_data = {
        'food_name': food_name,
        'food_type': food_type,
        'food_consistency': food_consistency,
        'food_registration_number': food_registration_number,
        'manufacturer_name': manufacturer_name,
        'manufacturer_address': manufacturer_address,
        'shelf_life_option': shelf_life_option,
        'has_allergen': has_allergen,
        'allergen_groups': allergen_groups,
        'has_nutrition_claim': has_nutrition_claim,
        'main_ingredients': main_ingredients,
        'ins_results': ins_results,
        'ingredient_warnings': ingredient_warnings,
        'required_labels': ordered_labels,
        'has_desiccant': has_desiccant,
        'caffeine_option': caffeine_option,
        'container_type': container_type
    }
    
    # ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
    st.markdown("### üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô")
    
    try:
        word_stream = generate_label_word_report(report_data)
        st.download_button(
            label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word (.docx)",
            data=word_stream.getvalue(),
            file_name=f"label_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.docx",
            mime="application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            type="primary"
        )
    except Exception as e:
        st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word: {str(e)}")
